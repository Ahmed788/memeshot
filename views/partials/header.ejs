<style>
  img {
    transition: transform 0.3s ease;
  }

  a:hover img {
    transform: scale(1.1);
  }
</style>

<header style="background-color: #ffffff; padding: 1rem; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); position: sticky; top: 0; z-index: 100;">
  <!-- رسالة الترحيب -->
  <% if (user) { %>
    <div id="welcome-message" style="background: #f3f4f6; color: #1a1a1a; text-align: center; padding: 0.5rem 0; font-weight: 500;">
      Welcome, <%= user.name && user.name.trim() ? user.name : (user.username || 'User') %>
    </div>
  <% } %>

  <nav style="display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; flex-wrap: wrap;">
    <!-- الشعار -->
    <div style="display: flex; align-items: center; gap: 1rem; margin: 0.5rem 0;">
      <a href="/" style="text-decoration: none; display: flex; align-items: center;">
        <img src="/memeshot.webp" alt="MemShot Logo" width="32" height="32" style="margin-left: 0.5rem;">
        <h2 id="header-title" style="margin: 0; color: #1a1a1a; font-size: 1.2rem; font-weight: 700;">ميمشوت - إدارة الطلبات</h2>
      </a>
    </div>

    <!-- قائمة التنقل -->
    <ul style="list-style: none; display: flex; gap: 1rem; margin: 0; padding: 0; align-items: center; flex-wrap: wrap;">
      <!-- زر تبديل اللغة -->
      <li>
        <button id="language-switcher" style="background: none; border: none; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 5px; padding: 0.5rem; border-radius: 0.375rem; transition: all 0.2s;">
          <span id="language-text">English</span>
          <i class="fas fa-language"></i>
        </button>
      </li>
      
      <li>
        <a href="/" id="new-request-link" style="text-decoration: none; color: #4b5563; font-weight: 500; padding: 0.5rem; border-radius: 0.375rem; transition: all 0.2s; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 4C3 3.44772 3.44772 3 4 3H16C16.5523 3 17 3.44772 17 4V6C17 6.55228 16.5523 7 16 7H4C3.44772 7 3 6.55228 3 6V4Z" fill="#4b5563"/>
            <path d="M3 10C3 9.44771 3.44772 9 4 9H10C10.5523 9 11 9.44771 11 10V16C11 16.5523 10.5523 17 10 17H4C3.44772 17 3 16.5523 3 16V10Z" fill="#4b5563"/>
            <path d="M14 9C13.4477 9 13 9.44771 13 10V16C13 16.5523 13.4477 17 14 17H16C16.5523 17 17 16.5523 17 16V10C17 9.44771 16.5523 9 16 9H14Z" fill="#4b5563"/>
          </svg>
          <span id="new-request-text">تقديم طلب جديد</span>
        </a>
      </li>
      <li>
        <a href="/requests" id="manage-requests-link" style="text-decoration: none; color: #4b5563; font-weight: 500; padding: 0.5rem; border-radius: 0.375rem; transition: all 0.2s; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 2C8.44772 2 8 2.44772 8 3C8 3.55228 8.44772 4 9 4H11C11.5523 4 12 3.55228 12 3C12 2.44772 11.5523 2 11 2H9Z" fill="#4b5563"/>
            <path fill-rule="evenodd" clip-rule="evenodd" d="M4 5C4 3.89543 4.89543 3 6 3H14C15.1046 3 16 3.89543 16 5V17C16 18.1046 15.1046 19 14 19H6C4.89543 19 4 18.1046 4 17V5ZM14 5H6V17H14V5Z" fill="#4b5563"/>
          </svg>
          <span id="manage-requests-text">إدارة الطلبات</span>
        </a>
      </li>
      
      <% if (user) { %>
        <li style="margin-right: 0.5rem;">
          <div style="position: relative;">
            <button style="background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; color: #4b5563; font-weight: 500; padding: 0.5rem; font-size: 0.9rem;">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4ZM10 8C10 6.89543 10.8954 6 12 6C13.1046 6 14 6.89543 14 8C14 9.10457 13.1046 10 12 10C10.8954 10 10 9.10457 10 8Z" fill="#4b5563"/>
                <path fill-rule="evenodd" clip-rule="evenodd" d="M12 13C9.8578 13 7.737 13.3938 5.81789 14.1455C3.89878 14.8972 2.25 15.9818 1.05492 17.2913C0.417816 17.9999 0.417816 19.0001 1.05492 19.7087C2.25 21.0182 3.89878 22.1028 5.81789 22.8545C7.737 23.6062 9.8578 24 12 24C14.1422 24 16.263 23.6062 18.1821 22.8545C20.1012 22.1028 21.75 21.0182 22.9451 19.7087C23.5822 19.0001 23.5822 17.9999 22.9451 17.2913C21.75 15.9818 20.1012 14.8972 18.1821 14.1455C16.263 13.3938 14.1422 13 12 13ZM3.09421 18.5C4.18071 17.2686 5.70558 16.3717 7.42563 15.7288C9.14568 15.0859 11.0543 14.75 12.9289 14.75H13.0711C14.9457 14.75 16.8543 15.0859 18.5744 15.7288C20.2944 16.3717 21.8193 17.2686 22.9058 18.5C21.8193 19.7314 20.2944 20.6283 18.5744 21.2712C16.8543 21.9141 14.9457 22.25 13.0711 22.25H12.9289C11.0543 22.25 9.14568 21.9141 7.42563 21.2712C5.70558 20.6283 4.18071 19.7314 3.09421 18.5Z" fill="#4b5563"/>
              </svg>
              <%= user.name %>
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 15.5L7 10.5L17 10.5L12 15.5Z" fill="#4b5563"/>
              </svg>
            </button>
            
            <!-- قائمة المستخدم المنسدلة -->
            <div style="position: absolute; top: 100%; right: 0; background: white; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); min-width: 180px; padding: 0.5rem 0; margin-top: 0.5rem; display: none; z-index: 50;">
              <form action="/logout" method="POST" style="width: 100%;">
                <button type="submit" id="logout-btn" style="width: 100%; text-align: right; padding: 0.5rem 1rem; background: none; border: none; cursor: pointer; color: #4b5563; font-weight: 500; display: flex; align-items: center; gap: 0.5rem; transition: all 0.2s; font-size: 0.9rem;">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17 16L21 12M21 12L17 8M21 12H7M13 16V17C13 18.6569 11.6569 20 10 20H6C4.34315 20 3 18.6569 3 17V7C3 5.34315 4.34315 4 6 4H10C11.6569 4 13 5.34315 13 7V8" stroke="#4b5563" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span id="logout-text">تسجيل خروج</span>
                </button>
              </form>
            </div>
          </div>
        </li>
      <% } else { %>
        <script>
          window.location.href = '/login';
        </script>
      <% } %>
    </ul>
  </nav>
</header>

<script>
// خدمة إدارة اللغات
// خدمة إدارة اللغات
const LanguageService = {
  currentLanguage: localStorage.getItem('language') || 'ar',
  
  async loadTranslations() {
    try {
      const response = await fetch(`/locales/${this.currentLanguage}.json`);
      if (!response.ok) throw new Error('Network response was not ok');
      return await response.json();
    } catch (error) {
      console.error('Failed to load translations:', error);
      // Fallback إلى الإنجليزية إذا فشل التحميل
      if (this.currentLanguage === 'ar') {
        return {
          header: {
            title: "ميمشوت - إدارة الطلبات",
            new_request: "تقديم طلب جديد",
            manage_requests: "إدارة الطلبات",
            login: "تسجيل دخول",
            logout: "تسجيل خروج",
            language: "English"
          }
        };
      } else {
        return {
          header: {
            title: "MemShot - Requests Management",
            new_request: "New Request",
            manage_requests: "Manage Requests",
            login: "Login",
            logout: "Logout",
            language: "العربية"
          }
        };
      }
    }
  },

  async applyTranslations() {
    const translations = await this.loadTranslations();
    
    // عناصر الترجمة
    const elements = {
      'header-title': translations.header.title,
      'new-request-text': translations.header.new_request,
      'manage-requests-text': translations.header.manage_requests,
      'login-text': translations.header.login,
      'logout-text': translations.header.logout,
      'language-text': translations.header.language
    };

    // تطبيق الترجمة على كل عنصر
    Object.entries(elements).forEach(([id, text]) => {
      const element = document.getElementById(id);
      if (element) element.textContent = text;
    });

    // تغيير اتجاه الصفحة
    document.documentElement.dir = this.currentLanguage === 'ar' ? 'rtl' : 'ltr';
    document.documentElement.lang = this.currentLanguage;
    
    console.log('Language changed to:', this.currentLanguage);
  },

  async toggleLanguage() {
    this.currentLanguage = this.currentLanguage === 'ar' ? 'en' : 'ar';
    localStorage.setItem('language', this.currentLanguage);
    await this.applyTranslations();
  }
};

// تهيئة الصفحة
document.addEventListener('DOMContentLoaded', async () => {
  // تطبيق اللغة المحددة
  await LanguageService.applyTranslations();
  
  // إضافة حدث لزر تبديل اللغة
  const languageSwitcher = document.getElementById('language-switcher');
  if (languageSwitcher) {
    languageSwitcher.addEventListener('click', async (e) => {
      e.preventDefault();
      await LanguageService.toggleLanguage();
    });
  }
});
// تهيئة اللغة عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', async () => {
  const languageService = new LanguageService();
  
  // تعيين اتجاه الصفحة بناءً على اللغة
  document.documentElement.dir = languageService.currentLanguage === 'ar' ? 'rtl' : 'ltr';
  document.documentElement.lang = languageService.currentLanguage;
  
  await languageService.applyTranslations();
  
  // إضافة حدث لزر تبديل اللغة
  document.getElementById('language-switcher').addEventListener('click', async () => {
    await languageService.toggleLanguage();
  });
});
</script>

<script>
  // تفعيل القائمة المنسدلة للمستخدم
  document.addEventListener('DOMContentLoaded', function() {
    const userButton = document.querySelector('button[style*="align-items: center; gap: 0.5rem; color: #4b5563"]');
    if (userButton) {
      userButton.addEventListener('click', function(e) {
        e.stopPropagation();
        const dropdown = this.nextElementSibling;
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
      });
    }

    // إغلاق القائمة عند النقر خارجها
    document.addEventListener('click', function() {
      const dropdowns = document.querySelectorAll('div[style*="position: absolute; top: 100%; right: 0;"]');
      dropdowns.forEach(dropdown => {
        dropdown.style.display = 'none';
      });
    });
  });
</script>